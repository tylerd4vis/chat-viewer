<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Decoded Chat Viewer</title>
<style>
  body {font-family: system-ui, monospace; background: #f3f4f6; margin: 40px; line-height: 1.6; display: flex; flex-direction: column; gap: 10px;}
  .msg {padding: 12px 18px; border-radius: 12px; max-width: 80%; white-space: pre-wrap;}
  .user {background: #dbeafe; align-self: flex-end;}
  .ai {background: #e5e7eb; align-self: flex-start;}
</style>
</head>
<body>
<script>
  const data = new URLSearchParams(window.location.search).get("data");
  if (data) {
    const msgs = JSON.parse(decodeURIComponent(data));
    document.body.innerHTML = msgs.map(m => 
      `<div class="msg ${m.role}">${m.text.replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]))}</div>`
    ).join('');
  } else {
    document.body.innerHTML = '<p style="color:red;">No chat data found.</p>';
  }
  window.addEventListener('message', (e) => {
  if (e.data && e.data.type === 'chatData') {
    const msgs = e.data.msgs || [];
    document.body.innerHTML = msgs.map(m => 
      `<div class="msg ${m.role}">${m.text.replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]))}</div>`
    ).join('');
  }
});
</script>
</body>
</html>
